import _defineProperty from "@babel/runtime/helpers/defineProperty";
// FIXME - FAB-1732 looking at making a shared component for this

/**
 * @jsxRuntime classic
 * @jsx jsx
 */
// eslint-disable-next-line @atlaskit/ui-styling-standard/use-compiled -- Ignored via go/DSP-18766
import { jsx } from '@emotion/react';
import { PureComponent } from 'react';
import * as styles from './styles';
import { findDOMNode } from 'react-dom';
import { fg } from '@atlaskit/platform-feature-flags';
export default class Scrollable extends PureComponent {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "scrollableDiv", null);
    // API
    _defineProperty(this, "reveal", (child, forceToTop) => {
      if (child && this.scrollableDiv) {
        // Not using Element.scrollIntoView as it scrolls even to top/bottom of view even if
        // already visible
        const scrollableRect = this.scrollableDiv.getBoundingClientRect();
        const elementRect = fg('platform_editor_react18_phase2_v2') ? child.getBoundingClientRect() : findDOMNode(child).getBoundingClientRect();
        if (forceToTop || elementRect.top < scrollableRect.top) {
          this.scrollableDiv.scrollTop += elementRect.top - scrollableRect.top;
        } else if (elementRect.bottom > scrollableRect.bottom) {
          this.scrollableDiv.scrollTop += elementRect.bottom - scrollableRect.bottom;
        }
      }
    });
    _defineProperty(this, "scrollToBottom", () => {
      if (this.scrollableDiv) {
        this.scrollableDiv.scrollTop = this.scrollableDiv.scrollHeight;
      }
    });
    _defineProperty(this, "handleScroll", event => {
      const sampleOffset = 10;
      let firstElement;
      if (this.scrollableDiv) {
        const scrollableRect = this.scrollableDiv.getBoundingClientRect();
        firstElement = document.elementFromPoint(scrollableRect.left + sampleOffset, scrollableRect.top + sampleOffset);
      }
      if (this.props.onScroll && firstElement) {
        this.props.onScroll(firstElement, event);
      }
    });
    _defineProperty(this, "handleRef", ref => {
      this.scrollableDiv = ref;
    });
  }
  render() {
    const {
      children,
      className,
      maxHeight,
      onMouseLeave
    } = this.props;
    const style = maxHeight ? {
      maxHeight
    } : {};
    return (
      // eslint-disable-next-line jsx-a11y/no-static-element-interactions
      jsx("div", {
        // eslint-disable-next-line @atlaskit/ui-styling-standard/no-classname-prop -- Ignored via go/DSP-18766
        className: `emoji-scrollable ${className}`
        // eslint-disable-next-line @atlaskit/ui-styling-standard/no-imported-style-values -- Ignored via go/DSP-18766
        ,
        css: styles.emojiScrollable,
        onMouseLeave: onMouseLeave,
        onScroll: this.handleScroll,
        ref: this.handleRef
        // eslint-disable-next-line @atlaskit/ui-styling-standard/enforce-style-prop -- Ignored via go/DSP-18766
        ,
        style: style
      }, children)
    );
  }
}