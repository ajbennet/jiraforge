import _defineProperty from "@babel/runtime/helpers/defineProperty";
/**
 * @jsxRuntime classic
 * @jsx jsx
 */
import TextField from '@atlaskit/textfield';
import React, { PureComponent } from 'react';
import { injectIntl } from 'react-intl-next';
// eslint-disable-next-line @atlaskit/ui-styling-standard/use-compiled -- Ignored via go/DSP-18766
import { css, jsx } from '@emotion/react';
import ColorPalette from './internal/color-palette';
import { messages } from './i18n';
import { N80A } from '@atlaskit/theme/colors';
const fieldTextWrapperStyles = css({
  margin: `0 ${"var(--ds-space-100, 8px)"}`,
  // eslint-disable-next-line @atlaskit/ui-styling-standard/no-nested-selectors -- Ignored via go/DSP-18766
  '& [data-ds--text-field--container]': {
    borderColor: `var(--ds-border-bold, ${N80A})`
  }
});
class Picker extends PureComponent {
  constructor(...args) {
    super(...args);
    _defineProperty(this, "fieldTextWrapperKey", Math.random().toString());
    _defineProperty(this, "colorPaletteKey", Math.random().toString());
    _defineProperty(this, "onChange", evt => {
      // @ts-ignore
      this.props.onTextChanged(evt.target.value);
    });
    _defineProperty(this, "onKeyPress", event => {
      if (event.key === 'Enter') {
        this.props.onEnter();
      }
    });
    _defineProperty(this, "handleInputRef", ref => {
      this.inputRef = ref;
      if (ref && this.props.autoFocus) {
        this.focusInput();
      }
    });
    _defineProperty(this, "focusInput", () => {
      if (!this.inputRef) {
        return;
      }
      // Defer to prevent editor scrolling to top
      this.autofocusTimeout = setTimeout(() => {
        var _this$inputRef;
        (_this$inputRef = this.inputRef) === null || _this$inputRef === void 0 ? void 0 : _this$inputRef.focus();
      });
    });
  }
  render() {
    const {
      text,
      selectedColor,
      onColorClick,
      onColorHover,
      intl
    } = this.props;

    // Using <React.Fragment> instead of [] to workaround Enzyme
    // (https://github.com/airbnb/enzyme/issues/1149)
    return jsx(React.Fragment, null, jsx("div", {
      css: fieldTextWrapperStyles,
      key: this.fieldTextWrapperKey
    }, jsx(TextField, {
      value: text,
      isCompact: true,
      ref: this.handleInputRef,
      onChange: this.onChange,
      onKeyPress: this.onKeyPress,
      spellCheck: false,
      autoComplete: "off",
      "aria-label": intl.formatMessage(messages.statusInputLabel)
    })), jsx(ColorPalette, {
      key: this.colorPaletteKey,
      onClick: onColorClick,
      onHover: onColorHover,
      selectedColor: selectedColor
    }));
  }
  componentDidUpdate() {
    if (this.inputRef && this.props.autoFocus) {
      this.focusInput();
    }
  }
  componentWillUnmount() {
    if (this.autofocusTimeout !== undefined) {
      clearTimeout(this.autofocusTimeout);
    }
  }
}
_defineProperty(Picker, "defaultProps", {
  autoFocus: true
});
export const StatusPicker = injectIntl(Picker);